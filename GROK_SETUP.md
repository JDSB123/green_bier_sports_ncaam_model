# Grok Setup Guide - NCAA Basketball Prediction Model

This guide is optimized for AI assistants (like Grok) to understand and run this NCAA basketball prediction model.

## What This Repository Does

This is a containerized NCAA men's basketball prediction model (v33.6.5) that:
1. Fetches team ratings from Bart Torvik API (Go service)
2. Fetches betting odds from The Odds API (Rust service)
3. Generates predictions with betting edge calculations (Python service)
4. Outputs actionable betting recommendations

## Prerequisites

### System Requirements
- Docker and Docker Compose installed
- Windows PowerShell (for `.bat` scripts) OR adapt commands for Linux/macOS
- Python 3.x for setup scripts

### Required Secrets
Users must provide their own:
- **The Odds API Key** - Get free tier at https://the-odds-api.com/
- Database and Redis passwords (auto-generated by setup script)

## Quick Start (For AI Assistants)

### Step 1: Clone the Repository
```bash
git clone https://github.com/JDSB123/green_bier_sports_ncaam_model.git
cd green_bier_sports_ncaam_model
```

### Step 2: Generate Secrets
```bash
python ensure_secrets.py
```
This creates:
- `secrets/db_password.txt` - PostgreSQL password (auto-generated)
- `secrets/redis_password.txt` - Redis password (auto-generated)
- Prompts for `secrets/odds_api_key.txt` if missing

**Manual API key creation (if needed):**
```bash
# Create the API key file with your actual key from https://the-odds-api.com/
echo "your_actual_api_key_here" > secrets/odds_api_key.txt
```

### Step 3: Build the Container
```bash
docker compose build
```

### Step 4: Run Predictions
```powershell
# Windows
.\predict.bat

# Linux/macOS (create equivalent)
docker compose up --build prediction-service
```

## Usage Examples

```powershell
# Get today's predictions for all games
.\predict.bat

# Skip data sync (use cached data)
.\predict.bat --no-sync

# Predict specific game
.\predict.bat --game "Duke" "UNC"

# Predict for specific date
.\predict.bat --date 2025-12-20
```

## Architecture Overview

```
┌─────────────────────────────────────────────────────────┐
│              prediction-service (Docker)                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐ │
│  │ ratings-sync│  │odds-ingestion│  │  predictor.py  │ │
│  │   (Go)      │  │   (Rust)     │  │   (Python)     │ │
│  └──────┬──────┘  └──────┬───────┘  └────────┬───────┘ │
│         │                │                    │         │
│         └────────────────┴────────────────────┘         │
└─────────────────────────┼───────────────────────────────┘
                          │
                   ┌──────▼──────┐
                   │  PostgreSQL  │
                   │  + Redis     │
                   └─────────────┘
```

## Model Parameters

### Full Game Predictions
- **Home Court Advantage (Spread):** 5.8 points
- **Minimum Spread Edge:** 2.0 points
- **Minimum Total Edge:** 3.0 points (max 6.0)

### First Half Predictions
- **Home Court Advantage (Spread):** 3.6 points
- **Minimum Spread Edge:** 3.5 points
- **Minimum Total Edge:** 2.0 points (max 3.5)

## Data Sources

1. **Bart Torvik API** - Team efficiency ratings and Four Factors
   - Fields documented in `docs/BARTTORVIK_FIELDS.md`
2. **The Odds API** - Live betting odds for major sportsbooks

## Output Format

The model outputs:
- Predicted spread and confidence
- Predicted total points
- Betting edge calculation (predicted vs. market)
- Recommendations when edge exceeds thresholds

## Important Notes for AI Assistants

### Security
- ⚠️ Never commit or share contents of `secrets/` directory
- ⚠️ Each user needs their own Odds API key
- ✅ All secrets properly gitignored
- ✅ No hardcoded credentials in codebase

### Manual Operation
- No automated scheduling - operator must run `predict.bat`
- Services run once and exit (RUN_ONCE=true)
- No continuous polling or cron jobs
- Manual review required before acting on predictions

### Docker-First Design
- Everything runs inside containers
- No need to install Go, Rust, or Python dependencies locally
- Database and Redis managed by docker-compose
- Secrets mounted as `/run/secrets/*` inside containers

## File Structure

```
green_bier_sports_ncaam_model/
├── services/
│   ├── ratings-sync-go/        # Go: Fetch Bart Torvik data
│   ├── odds-ingestion-rust/    # Rust: Fetch odds data  
│   └── prediction-service-python/  # Python: Generate predictions
├── database/                   # PostgreSQL schema
├── secrets/                    # User secrets (gitignored)
│   ├── db_password.txt
│   ├── redis_password.txt
│   └── odds_api_key.txt
├── docs/                       # Documentation
├── docker-compose.yml          # Container orchestration
├── predict.bat                 # Main entry point
└── ensure_secrets.py           # Setup helper
```

## Troubleshooting

### Missing Secrets Error
```
ERROR: Secrets file not found: /run/secrets/odds_api_key
```
**Solution:** Run `python ensure_secrets.py` and provide your API key

### Container Build Fails
```
ERROR: Service 'prediction-service' failed to build
```
**Solution:** Ensure Docker is running and has sufficient resources

### No Games Found
```
No games found for today
```
**Solution:** Use `--date YYYY-MM-DD` to check a date with scheduled games

## Further Documentation

- **README.md** - Main project documentation
- **MODEL_END_TO_END_REVIEW.md** - Detailed model methodology
- **TEAM_MATCHING_SYSTEM.md** - How team name matching works
- **MANUAL_ONLY_MODE.md** - Manual operation philosophy
- **docs/BARTTORVIK_FIELDS.md** - Data field reference

## For Repository Owner

To make this repository accessible to Grok:
1. See `MAKING_REPO_PUBLIC.md` for instructions on changing repository visibility
2. Once public, Grok can access it at: https://github.com/JDSB123/green_bier_sports_ncaam_model

## License

Check the repository for license information before use.
